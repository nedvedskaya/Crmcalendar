# 📅 Обновление функций календаря

## ✅ Добавленные функции

### 1. **Интервальные записи** (задачи на несколько дней)
Теперь можно создавать записи, которые растягиваются на несколько дней с указанием даты начала и окончания.

#### Что изменилось:

**Добавлено поле "Дата окончания":**
- В форме создания/редактирования записи
- Опциональное поле - если не указано, запись на один день
- Если указано - запись отображается во все дни интервала

**Визуальное отображение:**
```tsx
// В карточке записи:
{record.endDate && (
  <span>→ {formatDate(record.endDate)}</span>
)}
```

---

### 2. **Категории из финансов**
К каждой записи теперь можно привязать категорию из раздела "Финансы → Новая операция".

#### Что изменилось:

**Добавлен выбор категории:**
- В компоненте `AppointmentInputs` (форма записи)
- Компактные кнопки выбора категорий (как на скриншоте)
- Цветные индикаторы для визуального разделения

**Отображение категории:**
- В календаре под названием услуги
- В детальной карточке клиента
- В модальном окне календаря

```tsx
{category && (
  <div className="flex items-center gap-1.5">
    <div 
      className="w-2 h-2 rounded-full" 
      style={{ backgroundColor: category.color }}
    />
    <span className="text-xs">{category.name}</span>
  </div>
)}
```

---

## 🔧 Технические изменения

### Обновленные файлы:

#### 1. `/src/utils/initialStates.ts`
```tsx
// Добавлены новые поля:
export const getInitialRecordState = () => ({
  service: '',
  amount: '',
  date: getDateStr(0),
  endDate: '',      // ← Новое поле
  time: '10:00',
  isPaid: false,
  category: ''      // ← Новое поле
});

export const getInitialCalendarEntryState = () => ({
  clientName: '',
  service: '',
  amount: '',
  date: getDateStr(0),
  endDate: '',      // ← Новое поле
  time: '10:00',
  isPaid: false,
  category: ''      // ← Новое поле
});
```

#### 2. `/src/app/App.tsx`

**AppointmentInputs - обновлен:**
```tsx
const AppointmentInputs = ({ data, onChange, categories }) => {
  // ... existing code ...
  
  {/* Дата окончания */}
  <div className="px-4 pt-3 pb-4 border-b border-zinc-100">
    <span className="text-[10px]">
      Дата окончания (если растягивается на несколько дней)
    </span>
    <input 
      type="date" 
      name="endDate" 
      value={String(data.endDate || '')} 
      onChange={onChange} 
    />
  </div>
  
  {/* Категория */}
  {categories && categories.length > 0 && (
    <div className="px-4 py-3 border-b border-zinc-100">
      <span className="text-[10px]">Категория</span>
      <div className="flex flex-wrap gap-2">
        {categories.map(cat => (
          <button /* категория */ />
        ))}
      </div>
    </div>
  )}
}
```

**CalendarView - обновлен:**
```tsx
const CalendarView = ({ 
  events, 
  clients, 
  onAddRecord, 
  onOpenClient, 
  categories // ← Новый проп
}) => {
  // Функция для проверки интервалов
  const isDateInRange = (event, checkDate) => {
    if (!event.endDate) {
      return event.date === checkDate;
    }
    return checkDate >= event.date && checkDate <= event.endDate;
  };
  
  // Фильтрация событий с учетом интервалов
  const evs = events.filter(e => isDateInRange(e, date));
}
```

**ClientDetails - обновлен:**
```tsx
const ClientDetails = ({ 
  // ... existing props ...
  categories // ← Новый проп
}) => {
  // Отображение категории в записях
  const category = categories?.find(cat => cat.id === record.category);
}
```

---

## 📱 Примеры использования

### Создание обычной записи (1 день):
1. Открыть календарь
2. Нажать "+" или выбрать дату
3. Заполнить форму:
   - Клиент
   - Услуга
   - Дата начала
   - Время
   - Категория (опционально)
   - Сумма

### Создание интервальной записи (несколько дней):
1. Открыть календарь
2. Нажать "+" или выбрать дату
3. Заполнить форму:
   - Клиент
   - Услуга
   - **Дата начала:** 15.01.2026
   - **Дата окончания:** 20.01.2026 ← Заполнить!
   - Категория: "Создание сплиттеров"
   - Сумма: 50000

**Результат:**
- Запись появится в календаре с 15 по 20 января
- В карточке будет показано: "15 янв → 20 янв"
- Категория отобразится цветным индикатором

---

## 🎨 Визуальные изменения

### В календаре:
```
┌─────────────────────────────────┐
│ 🚗 BMW X5                       │
│ • Создание сплиттеров           │  ← Категория с цветом
└─────────────────────────────────┘
```

### В детальной карточке записи:
```
┌─────────────────────────────────┐
│ ⏰ 10:00                         │
│                                 │
│ Иван Петров                     │
│ Создание сплиттеров             │
│ 🔵 Кузовные работы             │  ← Категория
│ 15 янв → 20 янв                │  ← Интервал
│                                 │
│ BMW X5                          │
│ +7 999 123-45-67                │
└─────────────────────────────────┘
```

### В карточке клиента (активные записи):
```
┌─────────────────────────────────┐
│ 📅 АКТИВНАЯ ЗАПИСЬ              │
│                                 │
│ Создание сплиттеров             │
│ 🔵 Кузовные работы             │  ← Категория
│ 15 янв → 20 янв      10:00     │  ← Интервал
└─────────────────────────────────┘
```

---

## 🔄 Связь с финансами

### Как это работает:

1. **Создание категорий** в разделе "Финансы"
   - Категории типа "Кузовные работы", "Покраска", "Детейлинг"
   - Каждая категория имеет цвет

2. **Привязка к записям** в календаре
   - При создании записи можно выбрать категорию
   - Категория сохраняется с записью

3. **Аналитика** (будущее развитие)
   - Можно будет фильтровать записи по категориям
   - Считать доход по каждой категории
   - Строить графики популярности услуг

---

## 💡 Преимущества

### Для пользователя:
- ✅ **Удобное планирование** сложных работ на несколько дней
- ✅ **Визуальная группировка** услуг по категориям
- ✅ **Единая система** учета между календарем и финансами
- ✅ **Быстрый фильтр** по типам услуг

### Для бизнеса:
- 📊 **Аналитика** по типам услуг
- 💰 **Прогнозирование** загрузки по категориям
- 🎯 **Оптимизация** расписания под популярные услуги
- 📈 **Планирование** ресурсов для длительных работ

---

## 🚀 Что дальше?

### Возможные улучшения:
- [ ] Фильтрация календаря по категориям
- [ ] Статистика по категориям в аналитике
- [ ] Цветовая индикация дней с записями разных категорий
- [ ] Автоматическое создание финансовой операции при выполнении записи
- [ ] Шаблоны интервальных записей для типовых работ
- [ ] Уведомления о начале/окончании интервальных работ

---

## 📝 Итог

Календарь теперь поддерживает:
1. ✅ **Интервальные записи** с датой начала и окончания
2. ✅ **Категории услуг** из раздела финансов
3. ✅ **Визуальные индикаторы** категорий с цветами
4. ✅ **Единую систему** учета по всему приложению

**Время разработки:** ~30 минут  
**Файлов изменено:** 2  
**Строк кода добавлено:** ~150  
**Качество:** ⭐⭐⭐⭐⭐
